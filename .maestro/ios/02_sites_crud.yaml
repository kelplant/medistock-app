# MediStock iOS - Sites CRUD Tests
# Prerequisites: User must be admin
appId: com.medistock.ios
---

# Setup: Login
- launchApp:
    clearState: true

- waitForAnimationToEnd

- tapOn: "Nom d'utilisateur"
- inputText: "admin"

- tapOn: "Mot de passe"
- inputText: "admin"

- tapOn: "Se connecter"

- waitForAnimationToEnd:
    timeout: 10000

# Navigate to Administration first
# Scroll down to ensure Administration is fully visible
- scrollUntilVisible:
    element:
      text: "Administration"
    direction: DOWN

- waitForAnimationToEnd

# Tap Administration row with retry
- tapOn:
    text: "Administration"
    index: 1
    retryTapIfNoChange: true

- waitForAnimationToEnd:
    timeout: 5000

# Take screenshot to debug
- takeScreenshot: "ios_after_admin_tap"

# Navigate to Sites
- tapOn:
    text: "Sites"
    retryTapIfNoChange: true

- waitForAnimationToEnd

# Test 1: Create a new site
# Tap the + button using accessibility label
- tapOn:
    text: "Ajouter un site"
    retryTapIfNoChange: true

- waitForAnimationToEnd:
    timeout: 3000

# The sheet should now be open with "Nouveau site" title
# Tap on the text field to focus it
- tapOn:
    text: "Nom du site"

# Enter site name
- inputText: "Site E2E Test iOS"

# Tap the "Ajouter" button to save
- tapOn:
    text: "Ajouter"

- waitForAnimationToEnd

# Verify site appears in list
- assertVisible: "Site E2E Test iOS"

- takeScreenshot: "ios_site_created"

# Test 2: Edit site
- tapOn: "Site E2E Test iOS"

- waitForAnimationToEnd:
    timeout: 3000

# Tap on the text field first to focus it
- tapOn:
    text: ".*Nom du site.*"
    optional: true
- tapOn:
    text: "Site E2E Test iOS"
    optional: true

# Clear and enter new name
- eraseText: 50
- inputText: "Site E2E Modified iOS"

# Save
- tapOn:
    text: "Enregistrer"

- waitForAnimationToEnd

# Verify modified name
- assertVisible: "Site E2E Modified iOS"

- takeScreenshot: "ios_site_edited"

# Test 3: Delete site
- longPressOn:
    text: "Site E2E Modified iOS"
    optional: true

- tapOn:
    text: ".*Supprimer.*"
    optional: true
- tapOn:
    text: ".*Delete.*"
    optional: true

# Confirm deletion if dialog appears
- tapOn:
    text: ".*Supprimer.*"
    optional: true

- waitForAnimationToEnd

- takeScreenshot: "ios_site_deleted"
