# MediStock iOS - Transfer Tests
# Tests inter-site product transfers
appId: com.medistock.ios
---

# Setup: Login
- launchApp:
    clearState: true

- waitForAnimationToEnd

- tapOn: "Nom d'utilisateur"
- inputText: "admin"

- tapOn: "Mot de passe"
- inputText: "admin123"

- tapOn: "Se connecter"

- waitForAnimationToEnd:
    timeout: 10000

# ========== PREREQUISITE: Create 2 sites if needed ==========
- tapOn: "Sites"

- waitForAnimationToEnd

# Create Site 1 if needed
- runFlow:
    when:
      visible: "Aucun site"
    commands:
      - tapOn: ".*Ajouter.*"
      - waitForAnimationToEnd
      - inputText: "Entrepôt Central"
      - tapOn: ".*Ajouter.*"
      - waitForAnimationToEnd

# Create Site 2
- tapOn:
    text: ".*Ajouter.*"
    optional: true

- waitForAnimationToEnd

- inputText: "Pharmacie Test"

- tapOn:
    text: ".*Ajouter.*"
    optional: true

- waitForAnimationToEnd

- takeScreenshot: "ios_transfer_sites_ready"

# ========== PREREQUISITE: Ensure product with stock exists ==========
- tapOn: "Produits"

- waitForAnimationToEnd

# Create product if needed
- runFlow:
    when:
      visible: "Aucun produit"
    commands:
      - tapOn: ".*Ajouter.*"
      - waitForAnimationToEnd
      - tapOn: "Nom du produit"
      - inputText: "Produit Transfer Test"
      - tapOn: ".*Ajouter.*"
      - waitForAnimationToEnd

# Add stock via purchase
- tapOn:
    text: "Achats"
    optional: true

- waitForAnimationToEnd

- tapOn:
    text: ".*Ajouter.*"
    optional: true

- waitForAnimationToEnd

# Fill purchase
- tapOn:
    text: ".*Produit.*"
    optional: true
- tapOn:
    text: ".*Transfer Test.*"
    optional: true

- tapOn:
    text: ".*Quantité.*"
    optional: true
- inputText: "200"

- tapOn:
    text: ".*Prix.*"
    optional: true
- inputText: "5"

- tapOn:
    text: ".*Ajouter.*"
    optional: true

- waitForAnimationToEnd

# ========== TEST: Create a Transfer ==========
- tapOn:
    text: "Transferts"
    optional: true

- waitForAnimationToEnd

- tapOn:
    text: ".*Ajouter.*"
    optional: true

- waitForAnimationToEnd

# Fill transfer form
# Select product
- tapOn:
    text: ".*Produit.*"
    optional: true
- tapOn:
    text: ".*Transfer Test.*"
    optional: true

# Select source site
- tapOn:
    text: ".*Site source.*"
    optional: true
- tapOn:
    text: ".*Entrepôt.*"
    optional: true

# Select destination site
- tapOn:
    text: ".*destination.*"
    optional: true
- tapOn:
    text: ".*Pharmacie.*"
    optional: true

# Enter quantity
- tapOn:
    text: ".*Quantité.*"
    optional: true
- inputText: "50"

# Validate
- tapOn:
    text: ".*Transférer.*"
    optional: true
- tapOn:
    text: ".*Valider.*"
    optional: true

- waitForAnimationToEnd

- takeScreenshot: "ios_transfer_created"

# ========== VERIFY: Check transfer list ==========
- assertVisible:
    text: ".*50.*"
    optional: true

- takeScreenshot: "ios_transfer_verification"
